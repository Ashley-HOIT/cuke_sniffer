<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<script type="text/javascript">
    $(document).ready(function(){
       CukeSniffer.init();
    });

    var CukeSniffer = {
        init: function(){
            CukeSniffer.actions.bind();
            CukeSniffer.view._startTooltips();
            CukeSniffer.view.hideRuleDetails();
        },
        view: {
            hideRuleDetails: function(){
                $(".rule .details").hide();
            },
            _startTooltips: function(){
                $(".glyphicon-question-sign, .small").tooltip();
            },
            _updateRuleRowColors: function(){
                $(".rule:visible:even").addClass("blueRow");
            }
        },
        actions: {
            bind: function(){
                CukeSniffer.actions._togglePanelHeaderIcons();
                CukeSniffer.actions._viewRules();
                CukeSniffer.actions._clickRule();
                CukeSniffer.actions._ruleFilters();
                CukeSniffer.actions.collapseRules();
                CukeSniffer.actions.expandRules();
            },
            _togglePanelHeaderIcons: function(){
                $(document).on("click", ".panel-title", function(){
                    var $icon = $(this).find(".glyphicon");
                    $icon.toggleClass("glyphicon-menu-down");
                    $icon.toggleClass("glyphicon-menu-up");
                });
            },
            _viewRules: function(){
                $(document).on("click", "#rulesTab", CukeSniffer.view._updateRuleRowColors);
            },
            _clickRule: function(){
                $(document).on("click", ".rule", function(){
                    var $details = $(this).find(".details");
                    $details.toggle();
                });
                $(document).on("click", ".rule :checkbox", function(event){
                    event.stopPropagation();
                });
            },
            _ruleFilters: function(){
                $(document).on("click", "#ruleFilters .btn", function(){
                    var $clickedCheckbox = $(this).find(":checkbox");
                    $(".rule").hide().removeClass("blueRow");
                    $("#ruleFilters .btn").each(function(index, button){
                        var $checkbox = $(button).find(":checkbox"),
                            filterName = $checkbox.data("rule-type"),
                                        //hate this hack.
                            checked = ($clickedCheckbox[0] == $checkbox[0]) ? !$checkbox.is(":checked") : $checkbox.is(":checked");
                        if(checked){
                            $("[rule-" + filterName + "]").show();
                        }
                    });
                    CukeSniffer.view._updateRuleRowColors();
                });
            },
            collapseRules: function(){
                $(document).on("click", "#collapseRules", function(){
                    $(".rule .details").hide();
                });
            },
            expandRules: function(){
                $(document).on("click", "#expandRules", function(){
                    $(".rule .details").show();
                });
            }
        }
    };
</script>
